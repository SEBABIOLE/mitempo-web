<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Redireccionando a Google...</title>
  <script>
    // Params que ya usás: ?u=3382416087&p=prueba (p es opcional)
    const q = new URLSearchParams(location.search);
    const userId = q.get("u") || "sin_dato";   // n8n espera esto en state
    const plan   = q.get("p") || "";           // si lo necesitás, lo recuperás luego por Sheets/DB

    // Mismos valores que ya tenías:
    const clientId    = "395746584240-ue4uh3k5p0a24db69jkhsq7at95ns0gv.apps.googleusercontent.com";
    const redirectUri = "https://sebabiole.app.n8n.cloud/webhook/google-callback";

    // Scopes: Sheets + Calendar + Drive.file (para compartir la hoja)
    const scopes = [
      "https://www.googleapis.com/auth/spreadsheets",
      "https://www.googleapis.com/auth/calendar",
      "https://www.googleapis.com/auth/drive.file"
    ].join(" ");

    const u = new URL("https://accounts.google.com/o/oauth2/v2/auth");
    u.searchParams.set("client_id", clientId);
    u.searchParams.set("redirect_uri", redirectUri);
    u.searchParams.set("response_type", "code");
    u.searchParams.set("scope", scopes);
    u.searchParams.set("access_type", "offline");             // refresh_token
    u.searchParams.set("include_granted_scopes", "true");
    u.searchParams.set("prompt", "consent");
    u.searchParams.set("state", userId);                      // <= SOLO el userId

    location.href = u.toString();
  </script>
</head>
<body>
  <p>Redirigiendo a Google para vincular tu cuenta...</p>
</body>
</html>
