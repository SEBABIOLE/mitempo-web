<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - MiTempo</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 20px auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; box-sizing: border-box; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #mensaje { margin-top: 10px; color: green; display: none; }
    </style>
</head>
<body>
    <h2>Registro de Usuario</h2>
    <form id="registroForm">
        <div class="form-group">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" required>
        </div>
        <div class="form-group">
            <label for="telefono">Teléfono (sin +):</label>
            <input type="tel" id="telefono" name="telefono" pattern="[0-9]{10}" placeholder="1234567890" required>
        </div>
        <button type="submit">Enviar Registro</button>
    </form>
    <div id="mensaje"></div>
    <p>¿Ya te registraste? <a href="#" id="activarLink" style="display: none;">Activar mi cuenta por WhatsApp</a></p>

    <script>
        document.getElementById('registroForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const nombre = document.getElementById('nombre').value;
            const telefono = document.getElementById('telefono').value;

            // Simulación de envío a n8n (reemplaza con tu webhook real)
            fetch('https://sebabiole.app.n8n.cloud/webhook/registro-formulario', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nombre: nombre, telefono: telefono })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('mensaje').style.display = 'block';
                document.getElementById('mensaje').textContent = 'Registro enviado con éxito!';
                document.getElementById('activarLink').style.display = 'inline';
                document.getElementById('activarLink').setAttribute('onclick', `activarWhatsapp('${telefono}')`);
            })
            .catch(error => {
                document.getElementById('mensaje').style.display = 'block';
                document.getElementById('mensaje').textContent = 'Error al enviar el registro.';
                console.error('Error:', error);
            });
        });

        function activarWhatsapp(telefono) {
            // Abre WhatsApp y notifica a n8n
            window.open('https://wa.me/17432734544?text=Hola,%20quiero%20activar%20mi%20cuenta', '_blank');
            fetch('https://sebabiole.app.n8n.cloud/webhook/activar-whatsapp', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ telefono: telefono })
            })
            .then(response => response.json())
            .then(data => console.log('Flujo iniciado:', data))
            .catch(error => console.error('Error al iniciar flujo:', error));
        }
    </script>
</body>
</html>
