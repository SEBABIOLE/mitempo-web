<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Activa tu asistente | MiTempo.app</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body>
  <div class="container mt-5">
    <div class="card mx-auto" style="max-width: 400px;">
      <div class="card-body text-center">
        <h5 class="card-title">¡Gracias por registrarte!</h5>
        <p class="card-text" id="info"></p>
        <a id="btnAuthorize" class="btn btn-primary">
          Autorizar con Google
        </a>
      </div>
    </div>
  </div>

  <script>
    // 1. Leer parámetros de URL
    const params = new URLSearchParams(window.location.search);
    const phone = params.get('phone') || '';
    const plan  = params.get('plan')  || '';
    document.getElementById('info').textContent =
      `Plan: ${plan}  |  Teléfono: ${phone}`;

    // 2. Construir URL de OAuth2
    const clientId = '395746584240-ue4uh3k5p0a24db69jkhsq7at95ns0gv.apps.googleusercontent.com';
    const redirectUri = encodeURIComponent(
      'https://sebabiole.app.n8n.cloud/webhook/google-callback'
    );
    const scope = encodeURIComponent(
      'https://www.googleapis.com/auth/calendar ' +
      'https://www.googleapis.com/auth/spreadsheets'
    );
    const state = encodeURIComponent(JSON.stringify({ phone, plan }));

    const oauthUrl =
      `https://accounts.google.com/o/oauth2/v2/auth` +
      `?client_id=${clientId}` +
      `&redirect_uri=${redirectUri}` +
      `&response_type=code` +
      `&scope=${scope}` +
      `&access_type=offline` +
      `&prompt=consent` +
      `&state=${state}`;

    // 3. Asignar URL al botón
    document.getElementById('btnAuthorize').href = oauthUrl;
  </script>
</body>
</html>
